<html>
    <head>
        <title>Polyglot Contrib</title>
        <meta charset='utf-8'>

        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link media="screen" rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro|Source+Serif+Pro" rel="stylesheet">
        <link href='https://cdn.jsdelivr.net/devicons/1.8.0/css/devicons.min.css' rel='stylesheet'>

        <style media="screen">
          body { padding-top: 70px; }

          table tbody {
            overflow: scroll;
          }

          .noMatches {
            visibility: hidden;
          }

          table td {
            line-height: 40px !important;
            vertical-align: middle;
          }

          .communities {
            font-size: 40px;
            text-align: center;
          }

          .contribDetails {
            text-align: center;
          }

          .contribDetails .gravatar {
            border: 3px solid #2893c8;
            width: 100px;
            border-radius: 50px;
          }

          .contribDetails .communities {
            font-size: 50px;
          }
        </style>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    </head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Polyglot Contrib</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#contribute"><strong>Contribute</strong></a></li>
            <li><a href="http://jlord.github.com/sheetsee.js" target="_blank">Powered by sheetsee.js</a></li>
            <li><a href="http://www.github.com/dshafik/polyglotcontrib.com" target="_blank">GitHub</a></li>
            <li><a href="http://www.twitter.com/dshafik" target="_blank">@dshafik</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="container">
      <div class="jumbotron">
        <p>
          We believe that cross-community pollination is necessary for reducing wasted effort, and spreading knowledge. So, if you're a PHP developer and you contributed to a Python project, or if you're a Java developer who contributed to a Golang project, you deserve some recognition!
        </p>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-xs-3">
            <div id="right-side">
                <div id="latestContrib"></div>
                <div id="selectedContrib"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-9">
          <form class="form-inline">
              <input id="tableFilter" type="text" placeholder="filter by.." class="form-control"></input>
              <span class="noMatches">no matches found</span>
          </form>
        </div>
        <div class="col-xs-12 col-md-9">
            <div id="contrib-table"></div>
        </div>
      </div>
      <hr>
      <div class="col-xs-12">
        <h3 id="contribute">Contribute!</h3>
        <iframe src="https://docs.google.com/forms/d/18qlNfULHRnxyx2PAe9MvpR0vgivcVfws2tgJXDJi22Y/viewform?embedded=true#start=embed" style="height: 500px;" class="col-xs-12" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>
        <div id="numberofContribs"></div>
      </div>
    </div><!-- end container -->

    <script id="contrib-table" type="text/html">
        <table class="table table-bordered table-hover">
          <thead>
            <tr><th class="header">Name</th><th>Communities</th><th>Contribution</th></tr>
          </thead>
          <tbody>
            {{#rows}}
                <tr id="{{rowNumber}}" class="contribRow">
                  <td><a href="{{url}}">{{name}}</a></td>
                  <td class="communities"><span class="devicons devicons-{{primarycommunity}}"></span> <i class="fa fa-arrows-h"></i> <span class="devicons devicons-{{contributioncommunity}}"></span></td>
                  <td><a href="{{contribution}}" target="_blank">See Contribution</a></tr>
            {{/rows}}
          </tbody>
        </table>
    </script>

    <script id="latestContrib" type="text/html">
      <div class="contribDetails">
        {{#rows}}
            <h4>Most Recent Contribution</h4>
            <div class="contributor">
              <img class="gravatar" src="{{gravatar}}">
              <h2><a href="{{url}}">{{name}}</a></h2>
            </div>
            <p class="communities"><span class="devicons devicons-{{primarycommunity}}"></span> <i class="fa fa-arrows-h"></i> <span class="devicons devicons-{{contributioncommunity}}"></span></p>
            <p>
              <a class="btn btn-primary btn-lg btn-block" href="{{contribution}}" target="_blank">See Contribution</a>
            </p>
        {{/rows}}
      </div>
    </script>

    <script id="numberofContribs" type="text/html">
        <p><strong><span class="red-text">{{numberofContribs}}</span> contributions!</p>
    </script>

    <script id="selectedContrib" type="text/html">
      <div class="contribDetails">
        {{#rows}}
            <h4>Selected Contribution</h4>
            <div class="contributor">
              <img class="gravatar" src="{{gravatar}}">
              <h2><a href="{{url}}">{{name}}</a></h2>
            </div>
            <p class="communities"><span class="devicons devicons-{{primarycommunity}}"></span> <i class="fa fa-arrows-h"></i> <span class="devicons devicons-{{contributioncommunity}}"></span></p>
            <p>
              <a class="btn btn-primary btn-lg btn-block" href="{{contribution}}" target="_blank">See Contribution</a>
            </p>
        {{/rows}}
      </div>
    </script>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var gData
            var URL = "1tQJnATL6gH_oqvUACqhmwJLyK8tOd7CSidcCU99jyjY"
                Tabletop.init({ key: URL, callback: showInfo, simpleSheet: true })
        });

        // so long, so messy
        function showInfo(gData) {
            tableOptions = {
                "data": gData,
                "tableDiv": "#contrib-table",
                "filterDiv": "#tableFilter"
            };
            // make the table, and the search bar
            Sheetsee.makeTable(tableOptions);
            Sheetsee.initiateTableFilter(tableOptions);

            // find the latest spot with the most important
            // info filled in (to prevent map breaking if
            // someone is currently editing spreadsheet)
            var theLatestContrib = findLatestCompleteContrib(gData);
            var latestContrib = Sheetsee.ich.latestContrib({
                rows: theLatestContrib
            });
            // set it and pan to it
            $('#latestContrib').html(latestContrib);

            // when someone clicks on a row, highlight it and
            $('.contribRow').on("click", function(event) {
                $('.contribRow').removeClass("selected-row");
                var rowNumber = $(this).closest("tr").attr("id");
                $('#' + rowNumber).addClass("selected-row");
                var dataElement = Sheetsee.getMatches(gData, rowNumber, "rowNumber");
                var selectedContrib = Sheetsee.ich.selectedContrib({
                    rows: dataElement
                });
                $('#latestContrib').css("display", "none");
                $('#selectedContrib').html(selectedContrib).css("display", "inline");
            })

            // so that the first map and info that loads
            // is complete and doesn't show rows that are
            // actively being edited by folk
            function findLatestCompleteContrib(data) {
                var latestCompleteContrib = [];
                var startWithLatestRow = data.reverse();
                startWithLatestRow.forEach(function(row){
                    if (!row.name || !row.primarycommunity || !row.contributioncommunity || !row.contribution) {
                      return;
                    } else {
                      latestCompleteContrib.push(row);
                    }
                });

                return latestCompleteContrib[0];
            }

            // find total number of spots added
            var theNumberofContribs = Sheetsee.ich.numberofContribs({
                numberOfContribs: gData.length
            })
            $('#numberofContribs').html(theNumberofContribs)

            if(window.location.hash && window.location.hash != "#contribute") {
                $('#tableFilter').val(window.location.hash.substring(1)).keyup()
                $('.contribRow').first().click()
            }
        }

        $(document).on('keyup', '#tableFilter', function() {
            window.location.hash = $(this).val()
            $('.contribRow').first().click()
        })
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script type="text/javascript" src='js/tabletop1.3.4.js'></script>
    <script type="text/javascript" src='js/sheetsee.js'></script>
</body>
</html>
